---
title: "Global Health & Economic Vulnerability"
format:
  html:
    toc: true
---

# Global Health Analysis

![](images/global_health.jpeg){width="70%" fig-alt="Global Health Overview Image"}

This website presents an exploratory data analysis of global health indicators
and their relationship to economic conditions across countries.

We combine **COVID-19 health data** from the [Google COVID-19 Open Data project](
https://github.com/GoogleCloudPlatform/covid-19-open-data) with **GDP per capita**
from the [World Bank API](https://api.worldbank.org/), and build a cleaned dataset
that can be reused for future work. We'll walk you through the entire process if
you would like to reproduce the same project at your own time!

---

## 1. Data Sources & Retrieval

We use two main sources:

::: {.columns}
::: {.column width="50%"}
### Health Data

- Provider: **Google / Harvard Global Health Institute (COVID-19 Open Data)**
- Format: CSV (`health.csv`)
- Access: Public Google Cloud Storage bucket  
- URL:  
  `https://storage.googleapis.com/covid19-open-data/v3/health.csv`
:::

::: {.column width="50%"}
### Economic Data

- Provider: **World Bank**
- Indicators:
  - `NY.GDP.PCAP.CD` — GDP per capita (current US$)
- Format: JSON from World Bank REST API
- Access: Public API endpoint
:::
:::

See the **Data & Methods** page for the exact Python code used to:

- Download `health.csv` directly from the URL
- Query the World Bank API for GDP per capita
- Merge both into a single tidy DataFrame (`df_clean`)

---

## 2. Key Questions

We focus on questions such as:

- How do **health outcomes** vary across income levels?
- Is there a visible relationship between **GDP per capita** and
  **COVID-19 burden** (e.g., cases or deaths per 100k)?
- Which regions appear as **outliers** in terms of health vs. income?

These are explored in more depth on the **Analysis & Visuals** page.

---

## 3. Interactive Exploration

Below is an example interactive widget that lets you explore a subset of
our final dataset.

### 3.1 Health Spending vs Life Expectancy

This interactive scatterplot lets you explore how life expectancy changes 
with health expenditure per capita, with bubble size capturing infant mortality 
and color showing health status groups.


```{python}
import pandas as pd
import plotly.express as px

# 1. Load enriched data
df_enriched = pd.read_csv("data/df_enriched.csv")

# 2. Create health_status if it doesn't already exist
if "health_status" not in df_enriched.columns:
    df_enriched["health_status"] = pd.cut(
        df_enriched["life_expectancy"],
        bins=[0, 65, 75, 80, 100],
        labels=["Low (≤65)", "Medium (65–75)", "High (75–80)", "Very High (>80)"],
    )

# 3. Prepare a clean subset for plotting (no NaNs in key columns)
plot_cols = [
    "health_expenditure_usd",
    "life_expectancy",
    "infant_mortality_rate",
    "location_key",
    "health_status",
]
df_plot = df_enriched.dropna(subset=plot_cols).copy()

# Ensure size column is non-negative and numeric
df_plot = df_plot[df_plot["infant_mortality_rate"] >= 0]

# 4. Build interactive Plotly scatter
fig = px.scatter(
    df_plot,
    x="health_expenditure_usd",
    y="life_expectancy",
    hover_name="location_key",
    color="health_status",
    size="infant_mortality_rate",
    size_max=30,
    title="Health Expenditure vs Life Expectancy (bubble size = Infant Mortality)",
    labels={
        "health_expenditure_usd": "Health Expenditure (USD per capita)",
        "life_expectancy": "Life Expectancy (years)",
        "infant_mortality_rate": "Infant Mortality (per 1,000 births)",
        "health_status": "Health Status Group",
    },
)

# log scale on x-axis
fig.update_xaxes(type="log")

fig

```

### 3.2 Correlation Matrix of Key Health Indicators

This interactive heatmap shows pairwise correlations between selected health and spending variables, 
helping you quickly see which indicators move together or in opposite directions.

```{python}
import pandas as pd
import plotly.express as px

df_enriched = pd.read_csv("data/df_enriched.csv")

corr_vars = [
"life_expectancy", "health_expenditure_usd", "infant_mortality_rate",
"physicians_per_1000", "smoking_prevalence", "diabetes_prevalence"
]

corr = df_enriched[corr_vars].corr().round(2)

fig = px.imshow(
corr,
text_auto=True,
color_continuous_scale="RdBu_r",
zmin=-1, zmax=1,
title="Interactive Correlation Matrix: Key Health Indicators"
)
fig

```

### 3.3 Country-Level Interactive Table

Use this interactive table to filter, sort, and search country-level statistics, making it easy to compare life expectancy, health spending, and infant mortality across countries.

```{python}
import pandas as pd
from itables import init_notebook_mode, show

# Enable itables for notebooks / Quarto
init_notebook_mode(all_interactive=True)

# Load enriched data
df_enriched = pd.read_csv("data/df_enriched.csv")

# Columns we want in the interactive table
table_cols = [
    "location_key",
    "life_expectancy",
    "health_expenditure_usd",
    "infant_mortality_rate",
]

# Keep only country-level rows and drop rows with missing key values
df_table = (
    df_enriched
    .loc[~df_enriched["location_key"].str.contains("_", na=False), table_cols]
    .dropna(subset=["life_expectancy", "health_expenditure_usd", "infant_mortality_rate"])
    .copy()
)

# Make numbers look nicer
df_table["life_expectancy"] = df_table["life_expectancy"].round(1)
df_table["health_expenditure_usd"] = df_table["health_expenditure_usd"].round(0)
df_table["infant_mortality_rate"] = df_table["infant_mortality_rate"].round(1)

# Show interactive table
show(
    df_table,
    columnDefs=[
        {"targets": 0, "title": "Country"},
        {"targets": 1, "title": "Life Expectancy (years)"},
        {"targets": 2, "title": "Health Expenditure (USD per capita)"},
        {"targets": 3, "title": "Infant Mortality (per 1,000 births)"},
    ],
)

```

## 4. Key Visualizations

Here are some of the main figures from our analysis.

### Model Performance
This plot compares different modeling approaches for predicting life expectancy 
and shows how closely their fitted values track the observed outcomes.

![](images/modelperformance.png){fig-alt="Model performance of life expectancy models" width="70%"}

### Global Distribution of Mortality
This figure summarizes the spread of different mortality indicators across countries, 
highlighting which types of mortality are most unevenly distributed.

![](images/globaldistribution_of_mortality.png){fig-alt="Global distribution of mortality rates" width="70%"}

### Distribution and Country Count
These plots group countries into health-status buckets and show how many fall into each category, making the global life-expectancy gap easier to see at a glance.

![](images/distribution_and_countrycount.png){fig-alt="Distribution of life expectancy and country counts" width="70%"}

### Correlation Matrix of Indicators
This correlation matrix visualizes how core health indicators and resource variables move together, 
helping to spot potential drivers of life expectancy.

![](images/corrmatrix_indicators.png){fig-alt="Correlation matrix of health indicators" width="70%"}

### Health Spending vs Life Expectancy
This chart shows how higher health expenditure is associated with longer life expectancy, while also revealing outliers that spend a lot but do not achieve proportionate health gains.

![](images/healthspending_on_lifeexpectancy.png){fig-alt="Health spending vs life expectancy plot" width="70%"}
